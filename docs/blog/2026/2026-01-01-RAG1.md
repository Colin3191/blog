---
title: LangChain.js RAG å®æˆ˜ï¼ˆä¸Šï¼‰ï¼šç¯å¢ƒæ­å»ºä¸æ–‡æ¡£å¤„ç†
date: 2026-01-01
author: Colin
tags: [RAG, LangChain, AI]
---

# LangChain.js RAG å®æˆ˜ï¼ˆä¸Šï¼‰ï¼šç¯å¢ƒæ­å»ºä¸æ–‡æ¡£å¤„ç†

> éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„æ™®åŠï¼ŒRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å·²æˆä¸ºä¼ä¸šçº§åº”ç”¨çš„æ ‡é…ã€‚ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨ç†Ÿæ‚‰çš„ JavaScript/TypeScript æŠ€æœ¯æ ˆæ¥æ„å»ºå¼ºå¤§çš„ AI åº”ç”¨ã€‚æœ¬æ–‡æ˜¯æˆ‘å­¦ä¹  LangChain.js çš„å­¦ä¹ ç¬”è®°ï¼Œè®°å½•äº†ä»é›¶å¼€å‘ RAG åº”ç”¨çš„è¿‡ç¨‹ã€‚

## ç›®å½•

- [ä»€ä¹ˆæ˜¯ RAG](#ä»€ä¹ˆæ˜¯-rag)
- [ä¸ºä»€ä¹ˆéœ€è¦ RAG](#ä¸ºä»€ä¹ˆéœ€è¦-rag)
- [RAG çš„åº”ç”¨åœºæ™¯](#rag-çš„åº”ç”¨åœºæ™¯)
- [RAG çš„æ ¸å¿ƒæ¦‚å¿µ](#rag-çš„æ ¸å¿ƒæ¦‚å¿µ)
- [æŠ€æœ¯æ ˆé€‰æ‹©](#æŠ€æœ¯æ ˆé€‰æ‹©)
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [Document æŠ½è±¡è¯¦è§£](#document-æŠ½è±¡è¯¦è§£)
- [æ–‡æ¡£åŠ è½½å™¨](#æ–‡æ¡£åŠ è½½å™¨)
- [ç¤ºä¾‹ï¼šåŠ è½½ PDF æ–‡æ¡£](#ç¤ºä¾‹åŠ è½½-pdf-æ–‡æ¡£)
- [æ–‡æœ¬åˆ†å‰²çš„é‡è¦æ€§](#æ–‡æœ¬åˆ†å‰²çš„é‡è¦æ€§)
- [RecursiveCharacterTextSplitter è¯¦è§£](#recursivecharactertextsplitter-è¯¦è§£)
- [å®æˆ˜ï¼šåŠ è½½ä¸åˆ†å‰²](#å®æˆ˜åŠ è½½ä¸åˆ†å‰²)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ä»€ä¹ˆæ˜¯ RAG

**RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** å¬èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œå…¶å®åŸç†ç‰¹åˆ«ç®€å•ã€‚

ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ**å¼€å·è€ƒè¯•**ã€‚

*   **ä¼ ç»Ÿçš„ LLMï¼ˆé—­å·è€ƒè¯•ï¼‰**ï¼šæ¨¡å‹å…¨é è®­ç»ƒæ—¶â€œèƒŒâ€ä¸‹æ¥çš„çŸ¥è¯†å›ç­”ã€‚å¦‚æœé—®å®ƒæœ€æ–°çš„æ–°é—»ï¼Œæˆ–è€…å…¬å¸å†…éƒ¨çš„ç§å¯†æ•°æ®ï¼Œå®ƒè¦ä¹ˆè¯´ä¸çŸ¥é“ï¼Œè¦ä¹ˆå°±å¼€å§‹ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ï¼ˆå¹»è§‰ï¼‰ã€‚
*   **RAGï¼ˆå¼€å·è€ƒè¯•ï¼‰**ï¼šå½“ç”¨æˆ·æé—®æ—¶ï¼Œç³»ç»Ÿå…ˆå»ç¿»é˜…ä½ æä¾›çš„â€œæ•™ç§‘ä¹¦â€ï¼ˆçŸ¥è¯†åº“ï¼‰ï¼Œæ‰¾åˆ°ç›¸å…³çš„æ®µè½ï¼Œç„¶åæŠŠè¿™äº›æ®µè½è¿åŒé—®é¢˜ä¸€èµ·æ‰”ç»™ LLMã€‚LLM çœ‹ç€å‚è€ƒèµ„æ–™å›ç­”ï¼Œè‡ªç„¶å°±å‡†ç¡®å¤šäº†ã€‚

æŠ€æœ¯ä¸Šçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

1. **æ£€ç´¢**ï¼šæ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œä»çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ç›¸å…³çš„æ–‡æ¡£
2. **å¢å¼º**ï¼šå°†è¿™äº›ç›¸å…³æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œä¸ç”¨æˆ·çš„é—®é¢˜ä¸€èµ·æä¾›ç»™å¤§è¯­è¨€æ¨¡å‹
3. **ç”Ÿæˆ**ï¼šå¤§æ¨¡å‹åŸºäºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ç”Ÿæˆå‡†ç¡®çš„ç­”æ¡ˆ

### ä¸€ä¸ªç®€å•çš„ä¾‹å­

æƒ³è±¡ä½ åœ¨å‘ä¸€ä¸ªåŠ©æ‰‹æé—®ï¼š

**ç”¨æˆ·**ï¼š"Nike 2023 å¹´çš„æ”¶å…¥æ˜¯å¤šå°‘ï¼Ÿ"

**æ²¡æœ‰ RAG çš„ LLM**ï¼š
> å¯èƒ½ä¼šå›ç­”ä¸çŸ¥é“ï¼Œæˆ–è€…ç»™å‡ºè¿‡æ—¶/é”™è¯¯çš„ä¿¡æ¯ï¼ˆå› ä¸ºæ¨¡å‹çš„è®­ç»ƒæ•°æ®æœ‰é™ï¼‰

**æœ‰ RAG çš„ LLM**ï¼š
> 1. å…ˆä» Nike 2023 å¹´çš„è´¢åŠ¡æŠ¥å‘Šä¸­æ£€ç´¢åˆ°ç›¸å…³æ®µè½
> 2. å°†è¿™äº›æ®µè½ä½œä¸ºä¸Šä¸‹æ–‡æä¾›ç»™æ¨¡å‹
> 3. æ¨¡å‹åŸºäºå‡†ç¡®çš„ä¿¡æ¯å›ç­”ï¼šNike 2023 å¹´çš„æ”¶å…¥æ˜¯ 512 äº¿ç¾å…ƒ

---

## ä¸ºä»€ä¹ˆéœ€è¦ RAG

- **è§£å†³å¹»è§‰é—®é¢˜**ï¼šå¼ºåˆ¶æ¨¡å‹å‚è€ƒçœŸå®æ–‡æ¡£ï¼Œå‡å°‘ç¼–é€ ä¿¡æ¯
- **çªç ´çŸ¥è¯†æˆªæ­¢**ï¼šå®æ—¶æ›´æ–°çŸ¥è¯†åº“ï¼Œè·å–æœ€æ–°ä¿¡æ¯
- **å¯éªŒè¯çš„æ¥æº**ï¼šæä¾›ç­”æ¡ˆå‡ºå¤„ï¼Œå¢åŠ å¯ä¿¡åº¦
- **ä¿æŠ¤éšç§å®‰å…¨**ï¼šåŸºäºä¼ä¸šå†…éƒ¨æ–‡æ¡£æ„å»ºç§æœ‰çŸ¥è¯†åº“

---

## RAG å¸¸è§çš„åº”ç”¨åœºæ™¯

- **ä¼ä¸šçŸ¥è¯†åº“é—®ç­”**ï¼šå‘˜å·¥å¿«é€ŸæŸ¥æ‰¾å…¬å¸æ”¿ç­–ã€æŠ€æœ¯æ–‡æ¡£ã€æµç¨‹è§„èŒƒ
- **æ™ºèƒ½å®¢æœç³»ç»Ÿ**ï¼š24*7 è‡ªåŠ¨å›ç­”å®¢æˆ·å¸¸è§é—®é¢˜
- **æ–‡æ¡£åˆ†æä¸ç†è§£**ï¼šå¿«é€Ÿä»é•¿ç¯‡æŠ¥å‘Šä¸­æå–å…³é”®ä¿¡æ¯

---

## RAG çš„æ ¸å¿ƒæ¦‚å¿µ

ç†è§£ RAG éœ€è¦æŒæ¡å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚

### 1. æ–‡æ¡£å‘é‡åŒ–ï¼ˆEmbeddingï¼‰

**é—®é¢˜**ï¼šè®¡ç®—æœºå¦‚ä½•ç†è§£"è‹¹æœæ‰‹æœº"å’Œ"iPhone"æ˜¯ç›¸ä¼¼çš„æ¦‚å¿µï¼Ÿ

**è§£å†³**ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—å‘é‡ï¼ˆä¸€ç»„æ•°å­—ï¼‰ï¼Œè¯­ä¹‰ç›¸è¿‘çš„æ–‡æœ¬åœ¨å‘é‡ç©ºé—´ä¸­è·ç¦»æ›´è¿‘ã€‚

**ç¤ºä¾‹**ï¼š
```
"è‹¹æœæ‰‹æœº"  â†’  [0.23, -0.45, 0.78, ...]
"iPhone"    â†’  [0.25, -0.43, 0.76, ...]
"é¦™è•‰"      â†’  [-0.67, 0.34, -0.12, ...]
```

å‰ä¸¤ä¸ªå‘é‡çš„è·ç¦»å¾ˆè¿‘ï¼Œè¡¨ç¤ºå®ƒä»¬è¯­ä¹‰ç›¸ä¼¼ã€‚

### 2. å‘é‡ç›¸ä¼¼åº¦

**ä½™å¼¦ç›¸ä¼¼åº¦**ï¼ˆCosine Similarityï¼‰æ˜¯æœ€å¸¸ç”¨çš„è®¡ç®—æ–¹æ³•ï¼š
- 1 = å®Œå…¨ç›¸åŒ
- 0 = å®Œå…¨ä¸ç›¸å…³
- -1 = å®Œå…¨ç›¸å

### 3. RAG çš„åŸºæœ¬æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAG å®Œæ•´æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç”¨æˆ·é—®é¢˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é‡åŒ–æŸ¥è¯¢  â”‚  å°†é—®é¢˜è½¬æ¢ä¸ºå‘é‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å‘é‡æœç´¢ï¼ˆæ£€ç´¢é˜¶æ®µï¼‰          â”‚
â”‚  â€¢ åœ¨å‘é‡åº“ä¸­æ‰¾åˆ°æœ€ç›¸ä¼¼çš„æ–‡æ¡£å—      â”‚
â”‚  â€¢ é€šå¸¸è¿”å› top-k ä¸ªç»“æœ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ„å»ºæç¤ºè¯ï¼ˆå¢å¼ºé˜¶æ®µï¼‰        â”‚
â”‚  â€¢ å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡          â”‚
â”‚  â€¢ ä¸ç”¨æˆ·é—®é¢˜ç»„åˆæˆå®Œæ•´çš„ prompt     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        LLM ç”Ÿæˆç­”æ¡ˆï¼ˆç”Ÿæˆé˜¶æ®µï¼‰      â”‚
â”‚  â€¢ åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆå‡†ç¡®çš„å›ç­”          â”‚
â”‚  â€¢ å¯ä»¥å¼•ç”¨æ¥æº                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
   è¿”å›ç­”æ¡ˆ
```

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å…ˆæŠŠçŸ¥è¯†åˆ‡ç¢ï¼ˆå‘é‡åŒ–ï¼‰ï¼Œå­˜èµ·æ¥ï¼ˆç´¢å¼•ï¼‰ï¼›ç­‰ç”¨æˆ·é—®çš„æ—¶å€™ï¼Œæœå‡ºç›¸å…³çš„ç¢ç‰‡ï¼ˆæ£€ç´¢ï¼‰ï¼Œæ‹¼åœ¨ä¸€èµ·ç»™ AI çœ‹ï¼ˆå¢å¼ºï¼‰ï¼Œæœ€åè®© AI å›ç­”ï¼ˆç”Ÿæˆï¼‰ã€‚

---

## æŠ€æœ¯æ ˆé€‰æ‹©

### ä¸ºä»€ä¹ˆé€‰æ‹© LangChain.jsï¼Ÿ

è¯´å®è¯ï¼Œå¸‚é¢ä¸Šå…³äº LangChain çš„æ•™ç¨‹ 90% éƒ½æ˜¯ Python çš„ã€‚é‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å¤´é“é€‰ JS ç‰ˆï¼Ÿ

1.  **å‰ç«¯å‹å¥½**ï¼šä½œä¸ºå‰ç«¯å‡ºèº«ï¼Œå®åœ¨ä¸æƒ³ä¸ºäº†å†™ä¸ª Demo å†å»æŠ˜è…¾ Python çš„è™šæ‹Ÿç¯å¢ƒã€åŒ…ç®¡ç†é‚£äº›ä¸œè¥¿ã€‚èƒ½ç”¨ TypeScript æå®šå…¨æ ˆï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ
2.  **å…¨æ ˆæ•´åˆ**ï¼šç°åœ¨çš„ Next.js / NestJS åº”ç”¨ç›´æ¥é›†æˆ LangChain.js éå¸¸é¡ºæ»‘ï¼Œä¸ç”¨å†å•ç‹¬èµ·ä¸€ä¸ª Python æœåŠ¡åšä¸­é—´å±‚ã€‚
3.  **ç±»å‹å®‰å…¨**ï¼šTypeScript çš„ç±»å‹æç¤ºåœ¨å¤„ç†å¤æ‚çš„æ•°æ®æµæ—¶çœŸçš„æ•‘å‘½ï¼Œæ¯” Python çŒœç±»å‹èˆ’æœå¤šäº†ã€‚

è™½ç„¶ JS ç‰ˆçš„æ–‡æ¡£æœ‰æ—¶å€™æ›´æ–°æ¯” Python ç‰ˆæ…¢åŠæ‹ï¼Œä½†ç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œå‘åŸºæœ¬éƒ½èƒ½å¡«ä¸Šã€‚

---

## ç¯å¢ƒå‡†å¤‡

å¼€å§‹æ­å»º RAG åº”ç”¨çš„å¼€å‘ç¯å¢ƒã€‚

### 1. å‰ç½®è¦æ±‚

- **Node.js**ï¼šå»ºè®® v18 æˆ–æ›´é«˜ç‰ˆæœ¬
- **åŒ…ç®¡ç†å™¨**ï¼špnpmã€npm æˆ– yarn
- **ä»£ç ç¼–è¾‘å™¨**ï¼šVS Code

### 2. åˆ›å»ºé¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir langchain-rag-demo
cd langchain-rag-demo

# åˆå§‹åŒ– npm é¡¹ç›®
npm init -y

# æˆ–è€…ä½¿ç”¨ pnpm
pnpm init
```

### 3. å®‰è£…ä¾èµ–

#### åŸºç¡€ä¾èµ–

```bash
# æ ¸å¿ƒåŒ…
pnpm add @langchain/core @langchain/community

# æ–‡æ¡£åŠ è½½å™¨ï¼ˆPDFã€æ–‡æœ¬ç­‰ï¼‰
pnpm add pdf-parse@1

# æ–‡æœ¬åˆ†å‰²å™¨
pnpm add @langchain/textsplitters

# ç¯å¢ƒå˜é‡ç®¡ç†
pnpm add dotenv
```

#### Embedding æœåŠ¡ï¼ˆæœ¬æ–‡ä½¿ç”¨ Ollamaï¼‰

```bash
# Ollamaï¼ˆæœ¬åœ°æ¨¡å‹ï¼Œæ— éœ€ API keyï¼‰
pnpm add @langchain/ollama
```

#### å‘é‡å­˜å‚¨

```bash
# å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆç”¨äºå­¦ä¹ ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆOllama æ— éœ€ API keyï¼‰ï¼š

```bash
# Ollamaï¼ˆæœ¬æ–‡ä½¿ç”¨ï¼‰
# æ— éœ€ API keyï¼Œç¡®ä¿ Ollama æœåŠ¡è¿è¡Œå³å¯
# é»˜è®¤åœ°å€ï¼šhttp://localhost:11434

# é˜¿é‡Œäº‘ç™¾ç‚¼ï¼ˆå¯é€‰ï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼‰
# DASHSCOPE_API_KEY=sk-your-dashscope-key-here
```

âš ï¸ **æ³¨æ„**ï¼šä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Gitï¼Œæ·»åŠ åˆ° `.gitignore`ï¼š

```bash
echo ".env" >> .gitignore
echo "node_modules" >> .gitignore
```

### 5. é…ç½® TypeScript

ç›´æ¥å¤åˆ¶å³å¯ï¼š

```json
{
  "compilerOptions": {
    "moduleDetection": "force",
    "module": "nodenext",
    "target": "es2022",
    "moduleResolution": "nodenext",
    "allowJs": true,
    "esModuleInterop": true,
    "isolatedModules": true,
  },
}
```

æ·»åŠ è¿è¡Œè„šæœ¬ï¼ˆ`package.json`ï¼‰ï¼š

```json
{
  "scripts": {
    "rag": "tsx src/rag/index.ts"
  },
  "type": "module"
}
```

å®‰è£…å¼€å‘ä¾èµ–ï¼š

```bash
pnpm add -D typescript tsx @types/node
```

---

## Document å¯¹è±¡ï¼šä¸‡ç‰©çš†å¯ Document

åœ¨ LangChain çš„ä¸–ç•Œé‡Œï¼Œä¸ç®¡ä½ è¯»çš„æ˜¯ PDFã€ç½‘é¡µã€Markdown è¿˜æ˜¯ Wordï¼Œæœ€ç»ˆéƒ½ä¼šè¢«ç»Ÿä¸€å°è£…æˆ **Document** å¯¹è±¡ã€‚

ç†è§£å®ƒçš„ç»“æ„éå¸¸ç®€å•ï¼Œå®ƒå°±ä¸¤ä¸ªæ ¸å¿ƒå±æ€§ï¼š

```typescript
interface Document {
  pageContent: string;            // æ–‡æœ¬å†…å®¹
  metadata: Record<string, any>;  // å…ƒæ•°æ®ï¼ˆæ¥æºã€é¡µç ã€ä½œè€…ç­‰ï¼‰
}
```

### ä¸ºä»€ä¹ˆ Metadata å¾ˆé‡è¦ï¼Ÿ

å¾ˆå¤šæ–°æ‰‹å®¹æ˜“å¿½ç•¥ `metadata`ï¼Œåªå…³æ³¨æ–‡æœ¬å†…å®¹ã€‚ä½†åœ¨å®é™…çš„ RAG åº”ç”¨ä¸­ï¼Œå…ƒæ•°æ®æ˜¯**ç²¾å‡†æ£€ç´¢**çš„å…³é”®ã€‚

æ¯”å¦‚ï¼Œå½“ç”¨æˆ·é—®â€œNike 2023 å¹´çš„è¥æ”¶æ˜¯å¤šå°‘ï¼Ÿâ€æ—¶ï¼Œå¦‚æœä½ åœ¨æ£€ç´¢æ—¶èƒ½é€šè¿‡å…ƒæ•°æ®è¿‡æ»¤æ‰ `year: 2022` çš„æ–‡æ¡£ï¼Œå‡†ç¡®ç‡ç›´æ¥ç¿»å€ã€‚

### Document å¯¹è±¡ç¤ºä¾‹

è™½ç„¶æˆ‘ä»¬é€šå¸¸ä»æ–‡ä»¶åŠ è½½æ–‡æ¡£ï¼Œä½†ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º Document å¯¹è±¡æ¥ç†è§£å…¶ç»“æ„ï¼š

```typescript
import { Document } from "@langchain/core/documents";

const doc = new Document({
  pageContent: "Nike æ˜¯ä¸€å®¶å…¨çƒçŸ¥åçš„è¿åŠ¨å“ç‰Œï¼Œæˆç«‹äº 1967 å¹´ã€‚",
  metadata: {
    source: "nike-info",
    category: "company",
  },
});

console.log(doc.pageContent);
// è¾“å‡º: Nike æ˜¯ä¸€å®¶å…¨çƒçŸ¥åçš„è¿åŠ¨å“ç‰Œï¼Œæˆç«‹äº 1967 å¹´ã€‚
```

### Embedding æœåŠ¡ç¤ºä¾‹

æœ¬æ–‡ä½¿ç”¨ **Ollama æœ¬åœ°æ¨¡å‹**ï¼ˆå®Œå…¨å…è´¹ã€æ— éœ€ API keyï¼‰ã€‚

#### ä»€ä¹ˆæ˜¯å‘é‡ç»´åº¦ï¼Ÿ

**å‘é‡ç»´åº¦**ï¼ˆVector Dimensionï¼‰æŒ‡çš„æ˜¯ Embedding æ¨¡å‹ç”Ÿæˆçš„æ•°å­—å‘é‡çš„é•¿åº¦ã€‚

ç®€å•æ¥è¯´ï¼Œç»´åº¦è¶Šé«˜ï¼Œèƒ½è¡¨è¾¾çš„è¯­ä¹‰è¶Šä¸°å¯Œï¼Œä½†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ä¹Ÿè¶Šé«˜ã€‚æœ¬æ–‡ä½¿ç”¨çš„ **nomic-embed-text** æ¨¡å‹ç”Ÿæˆçš„å‘é‡ç»´åº¦æ˜¯ **768**ã€‚

#### ä½¿ç”¨ Ollama Embeddings

```typescript
import { OllamaEmbeddings } from "@langchain/ollama";

const embeddings = new OllamaEmbeddings({
  model: "nomic-embed-text",
  baseUrl: "http://localhost:11434",
});

// ç”Ÿæˆå‘é‡
const vector = await embeddings.embedQuery("Nike æ˜¯ä¸€å®¶è¿åŠ¨å“ç‰Œ");
console.log(`å‘é‡ç»´åº¦: ${vector.length}`);  // è¾“å‡ºï¼š768
console.log(`å‰ 10 ä¸ªå€¼: ${vector.slice(0, 10)}`);  // ç¤ºä¾‹ï¼š[-0.23, 0.45, ...]
```

**ä½¿ç”¨ Ollama å‰çš„å‡†å¤‡**ï¼š

1. **å®‰è£… Ollama**ï¼š
```bash
# macOS
brew install ollama

# Linux
curl -fsSL https://ollama.com/install.sh | sh
```

2. **æ‹‰å– embedding æ¨¡å‹**ï¼š
```bash
# æ¨èæ¨¡å‹ï¼ˆæ€§èƒ½å¥½ã€ä½“ç§¯å°ï¼‰
ollama pull nomic-embed-text
```

3. **å¯åŠ¨ Ollama æœåŠ¡**ï¼š
```bash
ollama serve
```

4. **éªŒè¯å®‰è£…**ï¼š
```bash
curl http://localhost:11434/api/tags
```

**è¯´æ˜**ï¼šOllama å®Œå…¨å…è´¹ï¼Œæ•°æ®åœ¨æœ¬åœ°è¿è¡Œã€‚å¦‚æœç¡¬ä»¶é…ç½®è¾ƒä½ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘ç™¾ç‚¼ç­‰äº‘æœåŠ¡ã€‚

---

## æ–‡æ¡£åŠ è½½å™¨ï¼šæŠŠæ•°æ®å–‚ç»™ LLM

LangChain æä¾›äº†æå…¶ä¸°å¯Œçš„åŠ è½½å™¨ï¼ˆLoadersï¼‰ï¼Œå‡ ä¹æ”¯æŒæ‰€æœ‰ä½ èƒ½æƒ³åˆ°çš„æ•°æ®æºã€‚

### å¸¸ç”¨åŠ è½½å™¨ä¸€è§ˆ

*   **PDFLoader**: å¤„ç† PDF æ–‡ä»¶ï¼ˆæœ¬æ–‡é‡ç‚¹ï¼‰ã€‚
*   **TextLoader**: å¤„ç† `.txt`ã€`.md` ç­‰çº¯æ–‡æœ¬ã€‚
*   **CSVLoader / JSONLoader**: å¤„ç†ç»“æ„åŒ–æ•°æ®ã€‚
*   **CheerioWebBaseLoader**: çˆ¬å–ç½‘é¡µå†…å®¹ã€‚
*   **NotionLoader / GitHubLoader**: å¯¹æ¥ç¬¬ä¸‰æ–¹å·¥å…·ã€‚

ä½ å¯ä»¥åœ¨ [LangChain å®˜æ–¹æ–‡æ¡£](https://js.langchain.com/docs/integrations/document_loaders/) ä¸­æ‰¾åˆ°å‡ ç™¾ç§é›†æˆã€‚ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œ**PDF å’Œ Markdown** æ˜¯æœ€å¸¸è§çš„ä¸¤ç§æ ¼å¼ã€‚

### ç¤ºä¾‹ï¼šåŠ è½½ PDF æ–‡æ¡£

æˆ‘ä»¬ç›´æ¥è¿›å…¥å®æˆ˜ï¼Œä½¿ç”¨ Nike 2023 å¹´è´¢åŠ¡æŠ¥å‘Šï¼ˆ10-K æ–‡ä»¶ï¼‰ä½œä¸ºæ¡ˆä¾‹ã€‚

### å‡†å¤‡å·¥ä½œ

é¡¹ç›®ä¸­çš„ PDF æ–‡ä»¶è·¯å¾„ï¼š

```
src/rag/data/nke-10k-2023.pdf
```

å¦‚éœ€ä¸‹è½½ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä½ç½®è·å–ï¼š
- [LangChain GitHub](https://github.com/langchain-ai/langchain/blob/v0.3/docs/docs/example_data/nke-10k-2023.pdf)

### ç¤ºä¾‹ 1ï¼šåŸºç¡€ PDF åŠ è½½

```typescript
import { PDFLoader } from '@langchain/community/document_loaders/fs/pdf';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const pdfPath = path.join(__dirname, 'data', 'nke-10k-2023.pdf');
const loader = new PDFLoader(pdfPath);

const docs = await loader.load();
```

---

## æ–‡æœ¬åˆ†å‰²çš„é‡è¦æ€§

### ä¸ºä»€ä¹ˆéœ€è¦æ–‡æœ¬åˆ†å‰²ï¼Ÿ

åŠ è½½å®Œæ–‡æ¡£åï¼Œä¸‹ä¸€æ­¥æ˜¯å°†é•¿æ–‡æ¡£åˆ†å‰²æˆæ›´å°çš„æ–‡æœ¬å—ï¼ˆchunksï¼‰ã€‚è¿™æ˜¯å› ä¸ºï¼š

#### 1. LLM çš„ä¸Šä¸‹æ–‡çª—å£é™åˆ¶

- **GPT-3.5**ï¼š4K tokensï¼ˆçº¦ 3000 ä¸ªå•è¯ï¼‰
- **GPT-4**ï¼š8K-32K tokens
- **Claude 2**ï¼š100K tokens
- **æœ¬åœ°æ¨¡å‹**ï¼šé€šå¸¸æ›´å°

å¦‚æœæ–‡æ¡£å¤ªé•¿ï¼ŒLLM æ— æ³•ä¸€æ¬¡æ€§å¤„ç†ã€‚

#### 2. æé«˜æ£€ç´¢ç²¾åº¦

```
âŒ ä¸åˆ†å‰²çš„æƒ…å†µï¼š
æ•´ä¸ª 100 é¡µçš„ PDF â†’ ä¸€ä¸ªå‘é‡
â†’ æ£€ç´¢æ—¶åªèƒ½è¿”å›æ•´ç¯‡æ–‡æ¡£
â†’ ç²¾ç¡®åº¦ä½

âœ… åˆ†å‰²åï¼š
æ¯ 500-1000 å­—ç¬¦ â†’ ä¸€ä¸ªå‘é‡
â†’ æ£€ç´¢æ—¶è¿”å›ç›¸å…³æ®µè½
â†’ ç²¾ç¡®åº¦é«˜
```

#### 3. é¿å…ä¿¡æ¯"å†²æ·¡"

å‡è®¾ä½ åœ¨æŸ¥è¯¢ "Nike çš„æ¯›åˆ©ç‡"ï¼š

- **å¤§æ–‡æ¡£**ï¼šåŒ…å«å¤§é‡æ— å…³ä¿¡æ¯ï¼Œç›¸å…³çš„æ¯›åˆ©ç‡ä¿¡æ¯è¢«"å†²æ·¡"
- **å°æ–‡æ¡£**ï¼šé›†ä¸­åœ¨æ¯›åˆ©ç‡æ®µè½ï¼Œæ›´å®¹æ˜“è¢«æ£€ç´¢åˆ°

#### 4. èŠ‚çœæˆæœ¬

- å‘é‡åŒ–æ›´å°çš„æ–‡æœ¬å—æ›´ä¾¿å®œ
- æ£€ç´¢å’Œç”Ÿæˆçš„ token æ•°æ›´å°‘
- å‡å°‘ LLM çš„å¤„ç†æ—¶é—´

### åˆ†å‰²çš„æŒ‘æˆ˜

æ–‡æœ¬åˆ†å‰²ä¸æ˜¯ç®€å•çš„"æŒ‰å­—ç¬¦æ•°åˆ‡åˆ†"ï¼Œéœ€è¦è€ƒè™‘ï¼š

1. **è¯­ä¹‰å®Œæ•´æ€§**ï¼šä¸è¦åœ¨å¥å­ä¸­é—´åˆ‡æ–­
2. **ä¸Šä¸‹æ–‡è¿è´¯æ€§**ï¼šä¿ç•™è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡
3. **ä¿¡æ¯ä¸ä¸¢å¤±**ï¼šé‡è¦ä¿¡æ¯ä¸èƒ½è¢«åˆ†å‰²åˆ°ä¸¤ä¸ªå—
4. **å¤§å°é€‚ä¸­**ï¼šæ¯ä¸ªå—ä¸èƒ½å¤ªå¤§æˆ–å¤ªå°

---

## RecursiveCharacterTextSplitter è¯¦è§£

LangChain æä¾›äº†å¤šç§æ–‡æœ¬åˆ†å‰²å™¨ï¼Œå…¶ä¸­ **RecursiveCharacterTextSplitter** æ˜¯æœ€æ¨èçš„é€šç”¨é€‰æ‹©ã€‚

### å·¥ä½œåŸç†

å®ƒæŒ‰ä¼˜å…ˆçº§**é€’å½’åœ°**å°è¯•ä¸åŒçš„åˆ†éš”ç¬¦ã€‚å¦‚æœä¸€æ®µæ–‡æœ¬ç”¨ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦åˆ†å‰²åä»ç„¶è¶…è¿‡ `chunkSize`ï¼Œå®ƒä¼šæ‹¿é‚£ä¸€æ®µç»§ç»­ç”¨ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦åˆ†å‰²ï¼Œè€Œä¸æ˜¯åªåˆ†å‰²ä¸€æ¬¡ã€‚

```
1. æ®µè½åˆ†éš”ç¬¦  - ä¼˜å…ˆçº§æœ€é«˜
2. å¥å­åˆ†éš”ç¬¦ . æˆ– ! æˆ– ?
3. å•è¯åˆ†éš”ç¬¦ (ç©ºæ ¼)
4. å­—ç¬¦çº§åˆ†å‰² - æœ€åæ‰‹æ®µ
```

### æ ¸å¿ƒå‚æ•°

```typescript
import { RecursiveCharacterTextSplitter } from "@langchain/textsplitters";

const textSplitter = new RecursiveCharacterTextSplitter({
  keepSeparator: false,      // æ˜¯å¦åœ¨è¾“å‡ºä¸­ä¿ç•™åˆ†éš”ç¬¦ï¼ˆå¯é€‰ï¼‰
  lengthFunction: (text) => text.length,  // è®¡ç®—é•¿åº¦çš„å‡½æ•°ï¼ˆå¯é€‰ï¼‰
});
```

> ğŸ’¡ **é¿å‘æŒ‡å—ï¼šå­—ç¬¦ vs Token**
> 
> åœ¨ LangChain.js ä¸­ï¼Œé»˜è®¤çš„ `chunkSize` æ˜¯åŸºäº**å­—ç¬¦æ•°**ï¼ˆCharactersï¼‰è®¡ç®—çš„ã€‚è€Œå¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼ˆContext Windowï¼‰æ˜¯åŸºäº **Tokens** è®¡ç®—çš„ã€‚
> - å¯¹äºè‹±æ–‡ï¼š1 ä¸ª Token $\approx$ 4 ä¸ªå­—ç¬¦æˆ– 0.75 ä¸ªå•è¯ã€‚
> - å¯¹äºä¸­æ–‡ï¼š1 ä¸ªæ±‰å­—é€šå¸¸å ç”¨ 1~2 ä¸ª Tokensã€‚
> 
> å¦‚æœä½ çš„æ–‡æ¡£ä¸»è¦æ˜¯ä¸­æ–‡ï¼Œå»ºè®® `chunkSize` è®¾ç½®å¾—ç¨å¾®å°ä¸€ç‚¹ï¼ˆå¦‚ 500-800ï¼‰ï¼Œä»¥é˜²å•ä¸ªå—çš„ Token æ•°è¶…å‡ºæ¨¡å‹é™åˆ¶ã€‚


### å‚æ•°è¯¦è§£

#### 1. chunkSizeï¼ˆå—å¤§å°ï¼‰

å®šä¹‰æ¯ä¸ªæ–‡æœ¬å—çš„æœ€å¤§å­—ç¬¦æ•°ã€‚

**å‚è€ƒå€¼**ï¼šä» 1000 å¼€å§‹ï¼Œæ ¹æ®å®é™…æ•ˆæœè°ƒæ•´ã€‚

#### 2. chunkOverlapï¼ˆé‡å å¤§å°ï¼‰

ç›¸é‚»æ–‡æœ¬å—ä¹‹é—´å…±äº«çš„å­—ç¬¦æ•°ã€‚

**ä½œç”¨**ï¼š
- ä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§
- é¿å…é‡è¦ä¿¡æ¯åœ¨è¾¹ç•Œè¢«åˆ‡æ–­
- ç¡®ä¿åŒä¸€ä¸ªå¥å­ä¸ä¼šåˆ†æ•£åˆ°å¤šä¸ªå—

**å‚è€ƒå€¼**ï¼šchunkSize çš„ 10-20%

```typescript
// ç¤ºä¾‹
chunkSize: 1000
chunkOverlap: 200  // 20%

// ç»“æœï¼š
Chunk 1: [0:1000]
Chunk 2: [800:1800]   // 800-1000 é‡å 
Chunk 3: [1600:2600]  // 1600-1800 é‡å 
```

**ä¸ºä»€ä¹ˆéœ€è¦é‡å **ï¼Ÿ

```
âŒ æ— é‡å ï¼š
Chunk 1: "...å…¬å¸çš„æ¯›åˆ©ç‡ä¸º"
Chunk 2: "43.5%ï¼Œç›¸æ¯”å»å¹´ä¸‹é™äº†..."

â†’ æŸ¥è¯¢"æ¯›åˆ©ç‡æ˜¯å¤šå°‘ï¼Ÿ"æ—¶ï¼ŒChunk 1 ä¿¡æ¯ä¸å®Œæ•´

âœ… æœ‰é‡å ï¼š
Chunk 1: "...å…¬å¸çš„æ¯›åˆ©ç‡ä¸º 43.5%ï¼Œç›¸æ¯”å»å¹´..."
Chunk 2: "æ¯›åˆ©ç‡ä¸º 43.5%ï¼Œç›¸æ¯”å»å¹´ä¸‹é™äº† 250 ä¸ªåŸºç‚¹..."

â†’ ä¸¤ä¸ªå—éƒ½åŒ…å«å®Œæ•´ä¿¡æ¯
```

#### 3. separatorsï¼ˆåˆ†éš”ç¬¦åˆ—è¡¨ï¼‰

æ§åˆ¶æ–‡æœ¬å¦‚ä½•è¢«åˆ†å‰²ã€‚é»˜è®¤å€¼ï¼š`["\n\n", "\n", " ", ""]`

**è‡ªå®šä¹‰ç¤ºä¾‹**ï¼š

```typescript
// é’ˆå¯¹ Markdown çš„åˆ†å‰²å™¨
const markdownSplitter = new RecursiveCharacterTextSplitter({
  chunkSize: 1000,
  chunkOverlap: 200,
  separators: [
    "\n## ",      // äºŒçº§æ ‡é¢˜
    "\n### ",     // ä¸‰çº§æ ‡é¢˜
    "\n\n",       // æ®µè½
    "\n",         // è¡Œ
    " ",          // è¯
    ""            // å­—ç¬¦
  ],
});
```

### é€’å½’åˆ†å‰²çš„ä¼˜åŠ¿

ä¸ºä»€ä¹ˆå«â€œé€’å½’â€ï¼Ÿç®€å•è¯´å°±æ˜¯**ä¸æ­»æ¿**ã€‚

å®ƒä¸ä¼šä¸€ä¸Šæ¥å°±æš´åŠ›åœ°æŒ‰ 1000 å­—åˆ‡ä¸€åˆ€ã€‚å®ƒä¼šå…ˆè¯•ç€ç”¨â€œåŒæ¢è¡Œç¬¦â€ï¼ˆæ®µè½ï¼‰æ¥åˆ‡ã€‚å¦‚æœåˆ‡å®Œçš„ä¸€æ®µè¿˜æ˜¯å¤ªé•¿ï¼Œå®ƒä¼šå†è¿›åˆ°è¿™ä¸€æ®µé‡Œï¼Œç”¨â€œå•æ¢è¡Œç¬¦â€ï¼ˆå¥å­ï¼‰ç»§ç»­åˆ‡ã€‚

è¿™ç§æ–¹å¼æœ€å¤§ç¨‹åº¦åœ°ä¿ç•™äº†æ–‡æœ¬çš„è¯­ä¹‰ç»“æ„ï¼Œä¸ä¼šè«åå…¶å¦™åœ°æŠŠä¸€å¥è¯åˆ‡æˆä¸¤åŠã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š

**åŸå§‹æ–‡æœ¬**ï¼š
```
ç¬¬ä¸€æ®µã€‚

ç¬¬äºŒæ®µã€‚

ç¬¬ä¸‰æ®µã€‚ç¬¬å››æ®µã€‚ç¬¬äº”æ®µã€‚
```

**ä½¿ç”¨ RecursiveCharacterTextSplitterï¼ˆchunkSize=20ï¼‰**ï¼š

```
å°è¯• "\n\n" åˆ†å‰²ï¼š
âœ… ["ç¬¬ä¸€æ®µã€‚\n\nç¬¬äºŒæ®µã€‚\n\nç¬¬ä¸‰æ®µã€‚ç¬¬å››æ®µã€‚ç¬¬äº”æ®µã€‚"]

"ç¬¬ä¸€æ®µã€‚" å¤ªçŸ­ï¼Œç»§ç»­åˆ†å‰²

å°è¯• "\n" åˆ†å‰²ï¼š
âœ… ["ç¬¬ä¸€æ®µã€‚\n\nç¬¬äºŒæ®µã€‚\n\nç¬¬ä¸‰æ®µã€‚", "ç¬¬å››æ®µã€‚", "ç¬¬äº”æ®µã€‚"]

"ç¬¬ä¸€æ®µã€‚\n\nç¬¬äºŒæ®µã€‚\n\nç¬¬ä¸‰æ®µã€‚" ä»ç„¶å¤ªé•¿

å°è¯• " " åˆ†å‰²ï¼š
âœ… ["ç¬¬ä¸€æ®µã€‚\n\nç¬¬äºŒæ®µã€‚", "ç¬¬ä¸‰æ®µã€‚", "ç¬¬å››æ®µã€‚", "ç¬¬äº”æ®µã€‚"]
```

**å…¶ä»–åˆ†å‰²å™¨**ï¼ˆå¦‚ç®€å•çš„å­—ç¬¦åˆ†å‰²ï¼‰ï¼š

```
âŒ ["ç¬¬ä¸€æ®µã€‚\n\nç¬¬äºŒæ®µã€‚\n\nç¬¬", "ä¸‰æ®µã€‚ç¬¬å››æ®µã€‚ç¬¬äº”æ®µã€‚"]
â†’ åœ¨"ç¬¬"å­—å¤„æˆªæ–­ï¼Œç ´åäº†è¯­ä¹‰
```

> **ç»“è®º**ï¼šé™¤éä½ æœ‰éå¸¸ç‰¹æ®Šçš„æ ¼å¼éœ€æ±‚ï¼ˆæ¯”å¦‚ä»£ç æ–‡ä»¶ç”¨ `CodeTextSplitter`ï¼ŒMarkdown ç”¨ `MarkdownTextSplitter`ï¼‰ï¼Œå¦åˆ™**æ— è„‘é€‰ `RecursiveCharacterTextSplitter`** å°±å¯¹äº†ã€‚

---

## å®æˆ˜ï¼šåŠ è½½ä¸åˆ†å‰²

ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŠŠå­¦åˆ°çš„çŸ¥è¯†åº”ç”¨åˆ°ä»£ç ä¸­ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ RAG å…¥å£æ–‡ä»¶ `src/rag/index.ts`ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°æ–‡æ¡£çš„åŠ è½½å’Œåˆ†å‰²ã€‚

### å®Œæ•´ä»£ç å®ç°

ç¼–è¾‘ `src/rag/index.ts`ï¼š

```typescript
import { PDFLoader } from '@langchain/community/document_loaders/fs/pdf';
import { RecursiveCharacterTextSplitter } from '@langchain/textsplitters';
import path from 'path';
import { fileURLToPath } from 'url';
import 'dotenv/config';

// 1. è®¾ç½®è·¯å¾„
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const pdfPath = path.join(__dirname, 'data', 'nke-10k-2023.pdf');

// 2. åŠ è½½ PDF
console.log("ğŸ“„ æ­£åœ¨åŠ è½½æ–‡æ¡£...");
const loader = new PDFLoader(pdfPath);
const docs = await loader.load();
console.log(`âœ… åŠ è½½å®Œæˆï¼Œå…± ${docs.length} é¡µ`);

// 3. åˆ†å‰²æ–‡æœ¬
console.log("âœ‚ï¸  æ­£åœ¨åˆ†å‰²æ–‡æ¡£...");
const textSplitter = new RecursiveCharacterTextSplitter({
  chunkSize: 1000,
  chunkOverlap: 200,
});

const allSplits = await textSplitter.splitDocuments(docs);
console.log(`âœ… åˆ†å‰²å®Œæˆï¼Œå…±ç”Ÿæˆ ${allSplits.length} ä¸ªæ–‡æœ¬å—`);

// æ‰“å°ç¬¬ä¸€ä¸ªæ–‡æœ¬å—çœ‹çœ‹æ•ˆæœ
console.log("\nğŸ” ç¬¬ä¸€ä¸ªæ–‡æœ¬å—ç¤ºä¾‹ï¼š");
console.log(allSplits[0].pageContent.slice(0, 200) + "...");
console.log("\nå…ƒæ•°æ®ï¼š", allSplits[0].metadata);
```

### è¿è¡Œä»£ç 

```bash
pnpm rag
```

ä½ å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼Œè¯æ˜æ–‡æ¡£å·²ç»æˆåŠŸåŠ è½½å¹¶è¢«åˆ†å‰²æˆäº†æ›´å°çš„å—ï¼Œä¸ºåç»­çš„å‘é‡åŒ–åšå¥½äº†å‡†å¤‡ã€‚

```
ğŸ“„ æ­£åœ¨åŠ è½½æ–‡æ¡£...
âœ… åŠ è½½å®Œæˆï¼Œå…± 107 é¡µ
âœ‚ï¸  æ­£åœ¨åˆ†å‰²æ–‡æ¡£...
âœ… åˆ†å‰²å®Œæˆï¼Œå…±ç”Ÿæˆ 514 ä¸ªæ–‡æœ¬å—

ğŸ” ç¬¬ä¸€ä¸ªæ–‡æœ¬å—ç¤ºä¾‹ï¼š
Table of Contents
UNITED STATES
SECURITIES AND EXCHANGE COMMISSION...

å…ƒæ•°æ®ï¼š { source: '.../src/rag/data/nke-10k-2023.pdf', pdf: { ... }, loc: { pageNumber: 1 } }
```

---

## ç»éªŒä¹‹è°ˆï¼šå‚æ•°æ€ä¹ˆè°ƒï¼Ÿ

å¾ˆå¤šåŒå­¦é—® `chunkSize` å’Œ `chunkOverlap` åˆ°åº•è¯¥è®¾å¤šå°‘ï¼Ÿè¿™é‡Œåˆ†äº«ä¸€äº›æˆ‘çš„å®æˆ˜ç»éªŒï¼š

1.  **é»˜è®¤èµ·æ‰‹å¼**ï¼š`chunkSize: 1000, chunkOverlap: 200`ã€‚è¿™ä¸ªé…ç½®åœ¨å¤§å¤šæ•°é€šç”¨æ–‡æ¡£ï¼ˆå¦‚ PDF æŠ¥å‘Šã€æ–‡ç« ï¼‰ä¸Šè¡¨ç°éƒ½å¾ˆç¨³ã€‚
2.  **ä¸­æ–‡ç¯å¢ƒ**ï¼šå¦‚æœä½ çš„æ–‡æ¡£å…¨æ˜¯ä¸­æ–‡ï¼Œå»ºè®®é€‚å½“è°ƒå° `chunkSize`ï¼ˆæ¯”å¦‚ 500-800ï¼‰ã€‚å› ä¸ºä¸­æ–‡çš„ä¿¡æ¯å¯†åº¦æ¯”è‹±æ–‡å¤§ï¼ŒåŒæ ·çš„å­—ç¬¦æ•°ï¼Œä¸­æ–‡åŒ…å«çš„è¯­ä¹‰æ›´å¤šï¼Œå¤ªé•¿äº†å®¹æ˜“è®© Embedding æ¨¡å‹â€œæ¶ˆåŒ–ä¸è‰¯â€ã€‚
3.  **é‡å çš„é‡è¦æ€§**ï¼š`chunkOverlap` åƒä¸‡åˆ«è®¾ä¸º 0ã€‚ä¿æŒ 10%-20% çš„é‡å èƒ½æœ‰æ•ˆé˜²æ­¢ä¸€å¥è¯è¢«åˆ‡æˆä¸¤åŠï¼Œå¯¼è‡´è¯­ä¹‰ä¸¢å¤±ã€‚
4.  **ç‰¹æ®Šåœºæ™¯ï¼šé—®ç­”å¯¹æ‹†åˆ†**ï¼šå¦‚æœä½ å¤„ç†çš„æ˜¯ FAQ æ–‡æ¡£ï¼ˆé—®ç­”å¯¹ï¼‰ï¼Œæ™®é€šçš„æŒ‰é•¿åº¦åˆ‡åˆ†å¯èƒ½ä¼šæŠŠé—®é¢˜å’Œç­”æ¡ˆåˆ‡å¼€ã€‚è¿™æ—¶å€™å¯ä»¥è€ƒè™‘é¢„å¤„ç†æ–‡æ¡£ï¼ŒæŠŠæ¯ä¸ªâ€œé—®é¢˜+ç­”æ¡ˆâ€åˆå¹¶æˆä¸€è¡Œï¼Œæˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼ˆå¦‚ `Q:`ï¼‰æ¥ç¡®ä¿å®ƒä»¬å§‹ç»ˆåœ¨åŒä¸€ä¸ª chunk é‡Œã€‚
5.  **è°ƒè¯•æŠ€å·§**ï¼šä¸è¦è¿·ä¿¡ç†è®ºå€¼ã€‚æœ€å¥½çš„åŠæ³•æ˜¯åƒä¸Šé¢ä»£ç é‚£æ ·ï¼Œæ‰“å°å‡ºå‰å‡ ä¸ª chunk çœ‹çœ‹ã€‚å¦‚æœå‘ç°ç»å¸¸æœ‰åŠæˆªå¥å­ï¼Œå°±è°ƒå¤§ overlapï¼›å¦‚æœå‘ç°åŒ…å«å¤ªå¤šæ— å…³åºŸè¯ï¼Œå°±è°ƒå° chunkSizeã€‚

---

### æœ¬æ–‡æºç 

ç¤ºä¾‹ä»£ç å·²ä¸Šä¼ è‡³githubï¼š
[https://github.com/Colin3191/langchain-demo](https://github.com/Colin3191/langchain-demo)
